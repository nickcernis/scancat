<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>scan.lol</title>
    <style>
        .message{

        }
        .error {
            color: red;
        }
    </style>
    <script language="javascript" type="text/javascript">

        var host = window.location.host; // Includes port number.
        var protocol = window.location.protocol == 'http:' ? 'ws://' : 'wss://';
        var wsUri = protocol + host + '/scan';

        var output, button, form, urlField;

        function init() {
            output = document.getElementById("output");
            button = document.getElementById("send");
            form = document.getElementById("url-form");
            urlField = document.getElementById("url");

            openWebSocket();

            form.addEventListener("submit", function (event) {
                output.innerHTML = '';
                doSend(urlField.value);
                event.preventDefault();
                urlField.value = '';
            });
        }

        function openWebSocket() {
            websocket = new WebSocket(wsUri);
            websocket.onopen = function (evt) { onOpen(evt) };
            websocket.onclose = function (evt) { onClose(evt) };
            websocket.onmessage = function (evt) { onMessage(evt) };
            websocket.onerror = function (evt) { onError(evt) };
        }

        function onOpen(evt) {
            writeToScreen("CONNECTED");
            //checkForURLAndAutoSubmit
        }

        function onClose(evt) {
            writeToScreen("DISCONNECTED");
        }

        function onMessage(evt) {
            writeToScreen('<span class="message">' + evt.data + '</span>');
            // websocket.close();
        }

        function onError(evt) {
            writeToScreen('<span class="error">ERROR:</span> ' + evt.data);
        }

        function doSend(message) {
            // writeToScreen("SENT: " + message);
            websocket.send(message);
        }

        function writeToScreen(message) {
            var pre = document.createElement("p");
            pre.style.wordWrap = "break-word";
            pre.innerHTML = message;
            output.appendChild(pre);
        }

        window.addEventListener("load", init, false);

    </script>
</head>

<body>
    <h1>scan.lol</h1>

    <form action="/" id="url-form">
        <input type="text" id="url">
        <button id="send">Scan</button>
    </form>

    <div id="output"></div>
</body>

</html>